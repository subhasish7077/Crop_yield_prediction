import pickle
from flask import Flask,request,app,jsonify,url_for,render_template
import numpy as np
import pandas as pd

app=Flask(__name__)
#Load the Model
regmodel=pickle.load(open('regression.pkl','rb'))
rescalar=pickle.load(open('scalar.pkl','rb'))
def create_newdata(n):
    features=['area','temperature','wind_speed','humidity','N','P','K','24 PARAGANAS NORTH','24 PARAGANAS SOUTH','ADILABAD','AGAR MALWA','AGRA','AHMADABAD','AHMEDNAGAR','AIZAWL','AJMER','AKOLA','ALAPPUZHA','ALIGARH','ALIRAJPUR','ALLAHABAD','ALMORA','ALWAR','AMBALA','AMBEDKAR NAGAR','AMETHI','AMRAVATI','AMRELI','AMRITSAR','AMROHA','ANAND','ANANTAPUR','ANANTNAG','ANJAW','ANUGUL','ANUPPUR','ARARIA','ARIYALUR','ARWAL','ASHOKNAGAR','AURAIYA','AURANGABAD','AZAMGARH','BADGAM','BAGALKOT','BAGESHWAR','BAGHPAT','BAHRAICH','BALAGHAT','BALANGIR','BALESHWAR','BALLIA','BALOD','BALODA BAZAR','BALRAMPUR','BANAS KANTHA','BANDA','BANDIPORA','BANGALORE RURAL','BANKA','BANKURA','BANSWARA','BARABANKI','BARAMULLA','BARAN','BARDHAMAN','BAREILLY','BARGARH','BARMER','BARNALA','BARPETA','BARWANI','BASTAR','BASTI','BATHINDA','BEED','BEGUSARAI','BELGAUM','BELLARY','BEMETARA','BENGALURU URBAN','BETUL','BHADRAK','BHAGALPUR','BHANDARA','BHARATPUR','BHARUCH','BHAVNAGAR','BHILWARA','BHIND','BHIWANI','BHOJPUR','BHOPAL','BIDAR','BIJAPUR','BIJNOR','BIKANER','BILASPUR','BIRBHUM','BISHNUPUR','BOKARO','BONGAIGAON','BOUDH','BUDAUN','BULANDSHAHR','BULDHANA','BUNDI','BURHANPUR','BUXAR','CACHAR','CHAMARAJANAGAR','CHAMBA','CHAMOLI','CHAMPAWAT','CHAMPHAI','CHANDAULI','CHANDEL','CHANDIGARH','CHANDRAPUR','CHANGLANG','CHATRA','CHHATARPUR','CHHINDWARA','CHIKBALLAPUR','CHIKMAGALUR','CHIRANG','CHITRADURGA','CHITRAKOOT','CHITTOOR','CHITTORGARH','CHURACHANDPUR','CHURU','COIMBATORE','COOCHBEHAR','CUDDALORE','CUTTACK','DADRA AND NAGAR HAVELI','DAKSHIN KANNAD','DAMOH','DANG','DANTEWADA','DARBHANGA','DARJEELING','DARRANG','DATIA','DAUSA','DAVANGERE','DEHRADUN','DEOGARH','DEOGHAR','DEORIA','DEWAS','DHALAI','DHAMTARI','DHANBAD','DHAR','DHARMAPURI','DHARWAD','DHEMAJI','DHENKANAL','DHOLPUR','DHUBRI','DHULE','DIBANG VALLEY','DIBRUGARH','DIMA HASAO','DIMAPUR','DINAJPUR DAKSHIN','DINAJPUR UTTAR','DINDIGUL','DINDORI','DODA','DOHAD','DUMKA','DUNGARPUR','DURG','EAST DISTRICT','EAST GARO HILLS','EAST GODAVARI','EAST JAINTIA HILLS','EAST KAMENG','EAST KHASI HILLS','EAST SIANG','EAST SINGHBUM','ERNAKULAM','ERODE','ETAH','ETAWAH','FAIZABAD','FARIDABAD','FARRUKHABAD','FATEHABAD','FATEHGARH SAHIB','FATEHPUR','FIROZABAD','FIROZEPUR','GADAG','GADCHIROLI','GAJAPATI','GANDERBAL','GANDHINAGAR','GANGANAGAR','GANJAM','GARHWA','GARIYABAND','GAUTAM BUDDHA NAGAR','GAYA','GHAZIABAD','GHAZIPUR','GIRIDIH','GOALPARA','GODDA','GOLAGHAT','GOMATI','GONDA','GONDIA','GOPALGANJ','GORAKHPUR','GULBARGA','GUMLA','GUNA','GUNTUR','GURDASPUR','GURGAON','GWALIOR','HAILAKANDI','HAMIRPUR','HANUMANGARH','HAPUR','HARDA','HARDOI','HARIDWAR','HASSAN','HATHRAS','HAVERI','HAZARIBAGH','HINGOLI','HISAR','HOOGHLY','HOSHANGABAD','HOWRAH','IDUKKI','IMPHAL EAST','IMPHAL WEST','INDORE','JABALPUR','JAGATSINGHAPUR','JAIPUR','JAISALMER','JAJAPUR','JALANDHAR','JALAUN','JALGAON','JALNA','JALORE','JALPAIGURI','JAMMU','JAMNAGAR','JAMTARA','JAMUI','JANJGIR-CHAMPA','JASHPUR','JAUNPUR','JEHANABAD','JHABUA','JHAJJAR','JHALAWAR','JHANSI','JHARSUGUDA','JHUNJHUNU','JIND','JODHPUR','JORHAT','JUNAGADH','KABIRDHAM','KACHCHH','KADAPA','KAIMUR (BHABUA)','KAITHAL','KALAHANDI','KAMRUP','KAMRUP METRO','KANCHIPURAM','KANDHAMAL','KANGRA','KANKER','KANNAUJ','KANNIYAKUMARI','KANNUR','KANPUR DEHAT','KANPUR NAGAR','KAPURTHALA','KARAIKAL','KARAULI','KARBI ANGLONG','KARGIL','KARIMGANJ','KARIMNAGAR','KARNAL','KARUR','KASARAGOD','KASGANJ','KATHUA','KATIHAR','KATNI','KAUSHAMBI','KENDRAPARA','KENDUJHAR','KHAGARIA','KHAMMAM','KHANDWA','KHARGONE','KHEDA','KHERI','KHORDHA','KHOWAI','KHUNTI','KINNAUR','KIPHIRE','KISHANGANJ','KISHTWAR','KODAGU','KODERMA','KOHIMA','KOKRAJHAR','KOLAR','KOLASIB','KOLHAPUR','KOLLAM','KONDAGAON','KOPPAL','KORAPUT','KORBA','KOREA','KOTA','KOTTAYAM','KOZHIKODE','KRISHNA','KRISHNAGIRI','KULGAM','KULLU','KUPWARA','KURNOOL','KURUKSHETRA','KURUNG KUMEY','KUSHI NAGAR','LAHUL AND SPITI','LAKHIMPUR','LAKHISARAI','LALITPUR','LATEHAR','LATUR','LAWNGTLAI','LEH LADAKH','LOHARDAGA','LOHIT','LONGDING','LONGLENG','LOWER DIBANG VALLEY','LOWER SUBANSIRI','LUCKNOW','LUDHIANA','LUNGLEI','MADHEPURA','MADHUBANI','MADURAI','MAHARAJGANJ','MAHASAMUND','MAHBUBNAGAR','MAHE','MAHENDRAGARH','MAHESANA','MAHOBA','MAINPURI','MALAPPURAM','MALDAH','MALKANGIRI','MAMIT','MANDI','MANDLA','MANDSAUR','MANDYA','MARIGAON','MATHURA','MAU','MAYURBHANJ','MEDAK','MEDINIPUR EAST','MEDINIPUR WEST','MEERUT','MEWAT','MIRZAPUR','MOGA','MOKOKCHUNG','MON','MORADABAD','MORENA','MUNGELI','MUNGER','MURSHIDABAD','MUZAFFARNAGAR','MUZAFFARPUR','MYSORE','NABARANGPUR','NADIA','NAGAON','NAGAPATTINAM','NAGAUR','NAGPUR','NAINITAL','NALANDA','NALBARI','NALGONDA','NAMAKKAL','NAMSAI','NANDED','NANDURBAR','NARAYANPUR','NARMADA','NARSINGHPUR','NASHIK','NAVSARI','NAWADA','NAYAGARH','NEEMUCH','NICOBARS','NIZAMABAD','NORTH AND MIDDLE ANDAMAN','NORTH DISTRICT','NORTH GARO HILLS','NORTH GOA','NORTH TRIPURA','NUAPADA','OSMANABAD','PAKUR','PALAKKAD','PALAMU','PALGHAR','PALI','PALWAL','PANCH MAHALS','PANCHKULA','PANIPAT','PANNA','PAPUM PARE','PARBHANI','PASHCHIM CHAMPARAN','PATAN','PATHANAMTHITTA','PATHANKOT','PATIALA','PATNA','PAURI GARHWAL','PERAMBALUR','PEREN','PHEK','PILIBHIT','PITHORAGARH','PONDICHERRY','POONCH','PORBANDAR','PRAKASAM','PRATAPGARH','PUDUKKOTTAI','PULWAMA','PUNE','PURBI CHAMPARAN','PURI','PURNIA','PURULIA','RAE BARELI','RAICHUR','RAIGAD','RAIGARH','RAIPUR','RAISEN','RAJAURI','RAJGARH','RAJKOT','RAJNANDGAON','RAJSAMAND','RAMANAGARA','RAMANATHAPURAM','RAMBAN','RAMGARH','RAMPUR','RANCHI','RANGAREDDI','RATLAM','RATNAGIRI','RAYAGADA','REASI','REWA','REWARI','RI BHOI','ROHTAK','ROHTAS','RUDRA PRAYAG','S.A.S NAGAR','SABAR KANTHA','SAGAR','SAHARANPUR','SAHARSA','SAHEBGANJ','SAIHA','SALEM','SAMASTIPUR','SAMBA','SAMBALPUR','SAMBHAL','SANGLI','SANGRUR','SANT KABEER NAGAR','SANT RAVIDAS NAGAR','SARAIKELA KHARSAWAN','SARAN','SATARA','SATNA','SAWAI MADHOPUR','SEHORE','SENAPATI','SEONI','SEPAHIJALA','SERCHHIP','SHAHDOL','SHAHJAHANPUR','SHAJAPUR','SHAMLI','SHEIKHPURA','SHEOHAR','SHEOPUR','SHIMLA','SHIMOGA','SHIVPURI','SHOPIAN','SHRAVASTI','SIDDHARTH NAGAR','SIDHI','SIKAR','SIMDEGA','SINDHUDURG','SINGRAULI','SIRMAUR','SIROHI','SIRSA','SITAMARHI','SITAPUR','SIVAGANGA','SIVASAGAR','SIWAN','SOLAN','SOLAPUR','SONBHADRA','SONEPUR','SONIPAT','SONITPUR','SOUTH ANDAMANS','SOUTH DISTRICT','SOUTH GARO HILLS','SOUTH GOA','SOUTH TRIPURA','SOUTH WEST GARO HILLS','SOUTH WEST KHASI HILLS','SPSR NELLORE','SRIKAKULAM','SRINAGAR','SUKMA','SULTANPUR','SUNDARGARH','SUPAUL','SURAJPUR','SURAT','SURENDRANAGAR','SURGUJA','TAMENGLONG','TAPI','TARN TARAN','TEHRI GARHWAL','THANE','THANJAVUR','THE NILGIRIS','THENI','THIRUVALLUR','THIRUVANANTHAPURAM','THIRUVARUR','THOUBAL','THRISSUR','TIKAMGARH','TINSUKIA','TIRAP','TIRUCHIRAPPALLI','TIRUNELVELI','TIRUPPUR','TIRUVANNAMALAI','TONK','TUENSANG','TUMKUR','TUTICORIN','UDAIPUR','UDALGURI','UDAM SINGH NAGAR','UDHAMPUR','UDUPI','UJJAIN','UKHRUL','UMARIA','UNA','UNAKOTI','UNNAO','UPPER SIANG','UPPER SUBANSIRI','UTTAR KANNAD','UTTAR KASHI','VADODARA','VAISHALI','VALSAD','VARANASI','VELLORE','VIDISHA','VILLUPURAM','VIRUDHUNAGAR','VISAKHAPATANAM','VIZIANAGARAM','WARANGAL','WARDHA','WASHIM','WAYANAD','WEST DISTRICT','WEST GARO HILLS','WEST GODAVARI','WEST JAINTIA HILLS','WEST KAMENG','WEST KHASI HILLS','WEST SIANG','WEST SINGHBHUM','WEST TRIPURA','WOKHA','YADGIR','YAMUNANAGAR','YANAM','YAVATMAL','ZUNHEBOTO','Banana','Cotton(lint)','Drum Stick','Maize','Onion','Potato','Ragi','Rice','Tomato','Andaman and Nicobar Islands','Andhra Pradesh','Arunachal Pradesh','Assam','Bihar','Chandigarh','Chhattisgarh','Dadra and Nagar Haveli','Goa','Gujarat','Haryana','Himachal Pradesh','Jammu and Kashmir ','Jharkhand','Karnataka','Kerala','Madhya Pradesh','Maharashtra','Manipur','Meghalaya','Mizoram','Nagaland','Odisha','Puducherry','Punjab','Rajasthan','Sikkim','Tamil Nadu','Telangana ','Tripura','Uttar Pradesh','Uttarakhand','West Bengal']
    new_data=[0.]*len(features)
    n=list(n)
    for i in range(len(features)):
        if(i<7):
            new_data[i]=n[i+3]
        else:
            for j in range(3):
                if(n[j]==features[i]):
                    new_data[i]=1.
#                     print(i)
    new_data=np.array(new_data)
    new_data=new_data.reshape(1,-1)
    return (new_data)

@app.route('/')
def home():
    return render_template('home.html')


@app.route('/predict_api',methods=['POST'])
def predict_api():
    data=request.get_json('data')
    print(data)
    n=data.values()
    new_data=create_newdata(n)
    new_data=rescalar.transform(new_data)
    output=regmodel.predict(new_data)
    print(output[0])
    return jsonify(output[0])

@app.route('/predict',methods=['POST'])
def predict():
    data=[i for i in request.form.values()]
    input=create_newdata(data)
    input=rescalar.transform(input)
    final_output=regmodel.predict(input)
    return render_template("home.html",Prediction_text="The yield prediction is {}.".format(round(final_output[0],4))) 

if(__name__)=="__main__":
    app.run(debug=True)
    

